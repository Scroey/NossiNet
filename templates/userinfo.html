{% extends "layout.html" %}
{% block head %}
    {% for headstate in heads %}
        {{ headstate|safe }}
    {% else %}
    {% endfor %}
{% endblock %}
{% block body %}
    {% if session.logged_in %}
        {% if session.get('user') != user.username %}
            <form action="{{ url_for('send_msg', username=user.username) }}" method=post class=add-entry>
                <dl>
                    <dt>Title:</dt>
                    <dd><input class=leet type=text size=30 name="title" , required></dd>
                    <dt>Text:</dt>
                    <dd><textarea class=leet name="text" rows=5 cols=40, required></textarea></dd>
                    <dt>Price to view</dt>
                    <dd><input class=leet value="0" type=number name="value" , required></dd>
                    <br>
                    <dd><input class=leeet type=submit value=Send></dd>
                </dl>
            </form>
            <h2>{{ user.username }} has {{ user.kudos }} Kudos.</h2>
        {% else %}
            <h2>You have {{ user.kudos }} Kudos.</h2>
            <h2>You have {{ user.funds }} Credits. <a href="{{ url_for('add_funds', user=user.username) }}"> BUY
                CREDITS </a></h2>
        {% endif %}

        {% for msg in msgs %}
            <br>__________________________________________________________<br>
            <h2>"{{ msg.title }}" by <a
                    href="{{ url_for('show_user_profile', username=msg.author) }}">{{ msg.author }}</a>
            </h2>{{ msg.text|safe }}
            {% if msg.value > 0 %}
                <br><h3>This message has a value of {{ msg.value }} and is{% if msg.lock %} locked{% else %}
                unlocked{% endif %}.

                {% if msg.lock %}
                    </h3><br>
                    <form action="{{ url_for('unlock', ident=msg.id) }}">
                        If you unlock this message, the price in kudos plus 10% your total kudos will be moved into
                        escrow for you and your partner. If it was to your liking you should honor the message,
                        giving back the amount in escrow for both and adding the price in kudos on top of that.
                        <br>
                        <br>
                        <input class=leeet type="submit" value="Unlock (costs {{ msg.value }})">
                    </form>
                    <br>
                    <h3>
                {% else %}
                    {% if msg.honored %}{% else %}<br>
                        <form action="{{ url_for('honor', ident=msg.id) }}">
                            <dd> If you liked this deal honor this deal you will gain {{ msg.kudosrep }}
                                and {{ msg.author }} will gain {{ msg.kudosaut }} Kudos.
                            </dd>
                            <input class=leeet type="submit" value="Honor it.">
                        </form>
                        <br> {% endif %}
                {% endif %}
                <br> This deal has{% if msg.honored %}{% else %} not{% endif %} been honored. </h3>
            {% endif %}
        {% endfor %}
    {% else %}
        <h2> You need to be logged in to see this page.</h2>
    {% endif %}
    <br><br>
    <button class="leeet" onclick="goBack()">Go Back</button>
{% endblock %}
